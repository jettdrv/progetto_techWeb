{% extends "users/dashboard.html" %}

{%block title%}
Dettagli gruppo
{% endblock %}

{% block content %}
<div class="group-details-container">
    <div class="private-group">
        <div class="add-discussion">
            <h3>Nuova Discussione</h3>
            <form method="post" action="{% url 'groups:add_discussion' group.id %}">
                {% csrf_token %}
                {{ discussion_form.as_p }}
                <button type="submit">Pubblica</button>
            </form>
        </div>
        {% if is_creator%} 
        <div class="manage-group">
                <a href="{% url 'groups:group_manage' group.id %}" class="main-buttons">Gestisci </a>
            </div>
            {% if group.privacy == 'private' %}
            <div class="invite-members">
                <a href="{% url 'groups:group_invite' group.id %}" class="main-buttons">Invita </a>
            </div>
            {% endif%}
        {% endif %}
        
    </div>

    <div class="old-discussion">
        <h3>Discussioni</h3>
        {% for d in discussions %}
        <div class="discussion-block">
            <div class="post-heading">
                <p><b>{{ d.creator.username }} - {{ d.creator.get_user_type_display }}</b></p>
                {% if d.creator.is_professional %}
                <p class="tag-expertise">{{ d.creator.expertise_field }}</p>
                {% endif %}
                <small>{{ d.created_at }}</small>
            </div>
            <div class="post-content">
                <p>{{ d.content }}</p>
            </div>

            {% if is_creator %}
                <form method="post" action="{% url 'groups:delete_discussion' d.id %}">
                {% csrf_token %}
                    <button type="submit" onclick="return confirm('Eliminare questa discussione?')"> Elimina
            </button>
                </form>

            {% endif %}

            <h4>Commenti</h4>
            <div  class="comments">
                {% for comment in d.comments.all %}
                        <small><b>{{ comment.creator.username }}</b>:</small> 
                        <small>{{ comment.created_at }}</small>
                    <div class="comment-content">
                        {{ comment.content }}
                        {% if is_creator %}
                        <form method="post" action="{% url 'groups:delete_comment' comment.id %}">
                        {% csrf_token %}
                    <button type="submit" onclick="return confirm('Eliminare questo commento?')"> Elimina
                        </button>
                        </form>

                        {% endif %}
                    </div>
                {% empty %}
                        Nessun commento
                {% endfor %}
            </div>

            <form method="post" action="{% url 'groups:add_comment' d.id %}">
                {% csrf_token %}
                {{ comment_form.as_p }}
                <button type="submit">Commenta</button>
            </form>
        </div>
        {% empty %}
        <p>Nessuna discussione ancora.</p>
    </div>
</div>
{% endfor %}
{% endblock %}


